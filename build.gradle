//http://htchttp.s3.amazonaws.com/books/Gradle%20Beyond%20the%20Basics.pdf
//https://github.com/codeborne/selenide/blob/master/build.gradle


version '1.0-SNAPSHOT'

task gradle_start {
println '\n---------------------START GRADLE------------------------'
}

buildscript {
repositories { jcenter() }
dependencies {  classpath 'de.undercouch:gradle-download-task:2.1.0'}
  }


task gradle_addbuildscript {
println '\n-------------------BUILD SCRIPT ADDED----------------------'
}

//apply plugin: 'maven'
apply plugin: 'java'
apply plugin: 'de.undercouch.download'

task gradle_plugin  {
println '\n-------------------BUILD PLUGIN ADDED----------------------'
}

sourceCompatibility = 1.8
targetCompatibility = 1.8

repositories {
    mavenCentral()
}

dependencies {

    testCompile('org.testng:testng:6.9.10') //http://mvnrepository.com/artifact/org.testng/testng/6.9.10
    testCompile 'org.uncommons:reportng:1.1.4'  //http://mvnrepository.com/artifact/org.uncommons/reportng
    testCompile 'org.seleniumhq.selenium:selenium-java:2.52.0'   //http://mvnrepository.com/artifact/org.seleniumhq.selenium/selenium-java
    testCompile 'com.google.inject:guice:3.0'
    testCompile 'velocity:velocity-dep:1.4'
 
   //	testCompile 'org.seleniumhq.selenium:selenium-ie-driver:2.44.0'
   //	testCompile 'org.seleniumhq.selenium:selenium-chrome-driver:2.52.0'

}

task gradle_dependencies  {
println '\n-------------------BUILD DEPENDENCIES ADDED----------------------\n\n'
}

//-------------------IE Driver start------------------
import de.undercouch.gradle.tasks.download.Download

task downloadIEDriverZip(type: Download) {
  src 'http://selenium-release.storage.googleapis.com/2.52/IEDriverServer_Win32_2.52.0.zip'
  dest new File(buildDir, 'IEDriverServer.zip')
  quiet false
  overwrite true
  onlyIfNewer true
  compress false
  println "Download IE driver: " + src
}

task downloadAndUnzipIEDriver(dependsOn: downloadIEDriverZip, type: Copy) {
  println "Unzip IE driver: " + downloadIEDriverZip.dest
  from zipTree(downloadIEDriverZip.dest)
  into buildDir
}

task ie(type: Test, dependsOn: downloadAndUnzipIEDriver) {
  
  systemProperties['selenide.browser'] = 'ie'
  systemProperties['webdriver.ie.driver'] = new File(buildDir, 'IEDriverServer.exe')
  println 'Use IE driver: ' + buildDir + '/IEDriverServer.exe'
  println 'System.setProperty(webdriver.ie.driver) -- configured to above location'
  
  systemProperties['selenide.timeout'] = '8000'
  include 'integration/**/*'
  exclude '**/AlertText.*'
  exclude '**/ConfirmTest.*'
  exclude 'com/codeborne/selenide/**/*'
}

task gradle_ie_Browser {
println '------------------- IE BROWSER CONFIGURED ----------------------\n\n'
}

//--------------------CHROME Driver start 
import org.gradle.internal.os.OperatingSystem;

task downloadChromeDriverZip(type: Download) {
  if (OperatingSystem.current().isMacOsX()) {
    src 'http://chromedriver.storage.googleapis.com/2.21/chromedriver_mac32.zip'
  }
  else if (OperatingSystem.current().isLinux()) {
    src 'http://chromedriver.storage.googleapis.com/2.21/chromedriver_linux64.zip'
  }
  else {
    src 'http://chromedriver.storage.googleapis.com/2.21/chromedriver_win32.zip'
  }
  dest new File(buildDir, 'chromedriver.zip')
  quiet false
  overwrite true
  onlyIfNewer true
  compress false
  println "\nDownload Chrome driver: " + src + " to " + dest
}

task downloadAndUnzipChromeDriver(dependsOn: downloadChromeDriverZip, type: Copy) {
  println "Unzip Chrome driver: " + downloadChromeDriverZip.dest
  from zipTree(downloadChromeDriverZip.dest)
  into buildDir
}

task chrome(type: Test, dependsOn: downloadAndUnzipChromeDriver) {
  
  systemProperties['selenide.browser'] = 'chrome'
  systemProperties['webdriver.chrome.driver'] = new File(buildDir, 'chromedriver')
  println 'Use Chrome driver: ' + buildDir + '/chromedriver'
  println 'System.setProperty(webdriver.chrome.driver) -- configured to above location'
  include 'integration/**/*'
  exclude 'com/codeborne/selenide/**/*'
}


task gradle_chrome_Browser {
println '------------------- CHROME BROWSER CONFIGURED ----------------------\n\n'
}


task gradle_test {
println '\n\n-------------------START TESTING ----------------------'
}

test {
	testLogging {
	
	showStandardStreams = true //enable system.out in console
	events "passed", "skipped", "failed", "standardOut", "standardError" //enable result
	}
	
    useTestNG {
        suites 'src/testng.xml'

        //set TestNG output dir
        outputDirectory = file("$project.buildDir//testNG_Output")

        //required to turn on TestNG reports
        useDefaultListeners = true

    }

    options {
        listeners << 'org.uncommons.reportng.HTMLReporter'
        listeners << 'org.uncommons.reportng.JUnitXMLReporter'
        listeners << 'com.report_generator.TestNGCustomReportListener'
    }

}

//task wrapper(type: Wrapper) {
//  gradleVersion = '2.11'
//  jarFile = './gradle-wrapper/gradle-wrapper.jar'
 // scriptFile = './gradle'
//}